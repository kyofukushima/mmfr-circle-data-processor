# 育児サークル情報処理アプリ

育児サークルデータの検証・修正・インポート処理を行うStreamlitアプリケーションです。

## 機能

### 📊 データ修正用エクセル作成
- 育児サークルCSVファイルの読み込み
- 施設情報CSVファイルとの突合処理
- 先月分データとの整合性チェック
- 修正用Excelファイルの生成（条件付き書式付き）

### 📋 インポートデータ作成
- 修正済みExcelファイルの検証（13項目の詳細検証）
- データ整形とインポート用CSV生成
- ユーザー新規追加データの自動作成
- セッション状態管理による安全な処理

## 検証項目

1. **修正・削除新規ステータス**: ステータス値の妥当性
2. **空欄ステータス**: 未記入時の変更検出
3. **機種依存文字**: 機種依存文字の検出
4. **セル内改行**: 改行文字の検出
5. **変更禁止列**: 変更禁止項目の保護
6. **連続した空白**: 連続空白の検出
7. **半角英数**: 数値項目の形式チェック
8. **メールアドレス**: メール形式の検証
9. **必須項目**: 必須フィールドの確認
10. **マルバツ**: ○/空欄形式の検証
11. **活動場所**: 施設情報との整合性
12. **ステータス**: publish/private値の検証
13. **webサイトURL**: URL有効性の確認
14. **アカウント発行年月**: 和暦形式の検証

## 使用方法

### データ修正用エクセル作成
1. 育児サークルCSVファイルをアップロード
2. 施設情報CSVファイルをアップロード
3. 先月分のデータ（Excelファイル）をアップロード
4. 自治体名を入力
5. 「処理開始」ボタンをクリック
6. 生成されたExcelファイルをダウンロード

### インポートデータ作成
1. 修正済みExcelファイルをアップロード
2. 施設情報CSVとユーザーデータCSVをアップロード
3. 検証項目を選択
4. 「データ検証開始」ボタンをクリック
5. エラーが0件の場合、「インポートデータ作成開始」ボタンをクリック
6. 生成されたCSVファイルをダウンロード

## 技術仕様

- **フレームワーク**: Streamlit
- **データ処理**: pandas, openpyxl
- **ファイル形式**: CSV, Excel (xlsx)
- **エンコーディング**: UTF-8, Shift-JIS, CP932, EUC-JP対応
- **非同期処理**: aiohttp（URL検証用）

## セキュリティ機能

- セッション状態の安全管理
- ファイル変更検出（MD5ハッシュ）
- 入力値の正規化処理
- エラーハンドリング

## 開発・テスト

テスト機能が充実しており、セッションリセット問題の予防が可能です：

```bash
# 全テスト実行
python run_all_tests.py

# セッション安全性チェック
python test_session_safety.py

# セッション管理テスト
python test_session_management.py
```

詳細は `README_TESTING.md` を参照してください。

## ライセンス

このプロジェクトは内部利用を目的としています。

## バージョン

v1.1 - 2025/01/25 